<html><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.01"><title>JS13k 2021</title><body class="full"><div id="root" class="full flex flex-centered fill-absolute"><canvas class="centered" id="canvas-pre"></canvas><canvas class="centered" id="canvas-tiles"></canvas><canvas class="centered" id="canvas-instruments"></canvas><canvas class="centered" id="canvas-oscillators"></canvas><canvas class="centered" id="canvas-post"></canvas><canvas class="centered" id="canvas-stats"></canvas><div class="full centered flex flex-centered" id="menu" style="visibility: hidden;"><div class="full flex flex-col" id="menu-col"><h1 id="osh" class="mb-2 mt-2" style="height: unset;">Oscillators</h1><p class="mb-2" style="height: unset;">Use oscillators to play instruments</p><div class="mb-5" style="height: unset;" class="flex flex-centered"><div id="os"></div></div><h1 id="inh" class="mb-2" style="height: unset;">Instruments</h1><p class="mb-2" style="height: unset;">Use instruments to create sounds and collect notes</p><div class="full" style="height: unset;" class="flex flex-centered"><div id="in" class="flex flex-row flex-centered"><p class="mb-2" style="height: unset;">Drums</p></div></div></div></div><div class="flex centered flex-centered" id="inspect" style="visibility: hidden;"><div id="inner-inspect" class="full flex flex-centered flex-col"><button id="close-inspect">✖</button><h1 class="mb-2" id="inspect-name">Snare</h1><div class="flex flex-centered"><p>Cost:&nbsp;</p><p class="pink" id="inspect-cost">50</p></div><div class="flex flex-centered mb-2"><p>Notes produced:&nbsp;</p><p class="green" id="inspect-notes">50</p></div><button class="flex flex-centered mb-2" id="sell-button"><p>Sell for&nbsp;</p><p class="green" id="inspect-sell">50</p></button></div></div><button class="mb-5" id="menu-button">✖</button></div><script>(()=>{"use strict";var t={28:(t,n,s)=>{s.d(n,{t:()=>o});var e=s(645),i=s.n(e)()((function(t){return t[1]}));i.push([t.id,"* {\n  color: white;\n  text-align: center;\n  padding: 0;\n  margin: 0;\n  font-size: 2vh;\n  font-family: Tahoma, sans-serif;\n  user-select: none;\n  overscroll-behavior: none;\n}\n\nh1 {\n  font-size: 3vh;\n  font-weight: normal;\n}\n\n\nbutton {\n  line-height: 0;\n  border-radius: 50%;\n  cursor: pointer;\n  border: .25vh solid white;\n  width: 7.5vh;\n  height: 7.5vh;\n  background-color: #272838;\n}\n\n:focus {\n  outline: none;\n}\n\n:disabled {\n  filter: brightness(.5) grayscale(.75)\n}\n\n.fill-absolute {\n  position: absolute;\n  top: 0;\n  left: 0;\n  overscroll-behavior: none;\n}\n\n.flex {\n  display: flex\n}\n\n.flex-col {\n  flex-direction: column;\n}\n\n.flex-centered {\n  align-items: center;\n  justify-content: center;\n}\n\n.centered {\n  position: absolute;\n  margin-left: auto;\n  margin-right: auto;\n}\n\n.full {\n  width: 100%;\n  height: 100%;\n}\n\n.full-w {\n  width: 100%;\n}\n\n.full-h {\n  height: 100%;\n}\n\n.pink {\n  color: #ff4c7a;\n}\n\n.green {\n  color: #00e19e;\n}\n\n.mb-5 {\n  margin-bottom: 5vh;\n}\n\n.mt-2 {\n  margin-top: 2vh;\n}\n\n.mb-2 {\n  margin-bottom: 2vh;\n}\n\n#osh {\n  color: #ff4c7a;\n}\n\n#inh {\n  color: #00e19e;\n}\n\n#menu-button {\n  position: absolute;\n  align-self: flex-end;\n  background: rgba(255, 255, 255, 0.1);\n  transition-duration: 250ms;\n  transform: rotate(45deg);\n}\n\n#canvas-stats {\n  cursor: grab;\n}\n\n#menu, #inner-inspect {\n  background: rgba(0,0,0,.85);\n}\n\n#menu {\n  justify-content: flex-start;\n}\n\n#close-inspect {\n  position: absolute;\n  top: 1vh;\n  left: 1vh;\n  width: 5vh;\n  height: 5vh;\n}\n\n#inner-inspect {\n  position: relative;\n  width: 100%;\n  height: 50%;\n  box-sizing: border-box;\n}\n\n#sell-button {\n  border-radius: 3vh;\n  border: .25vh solid white;\n  padding: 2vh;\n  width: unset;\n  height: unset;\n}",""]);const o=i},645:t=>{t.exports=function(t){var n=[];return n.toString=function(){return this.map((function(n){var s=t(n);return n[2]?"@media ".concat(n[2]," {").concat(s,"}"):s})).join("")},n.i=function(t,s,e){"string"==typeof t&&(t=[[null,t,""]]);var i={};if(e)for(var o=0;o<this.length;o++){var r=this[o][0];null!=r&&(i[r]=!0)}for(var h=0;h<t.length;h++){var c=[].concat(t[h]);e&&i[c[0]]||(s&&(c[2]?c[2]="".concat(s," and ").concat(c[2]):c[2]=s),n.push(c))}},n}},379:t=>{var n=[];function s(t){for(var s=-1,e=0;e<n.length;e++)if(n[e].identifier===t){s=e;break}return s}function e(t,e){for(var o={},r=[],h=0;h<t.length;h++){var c=t[h],a=e.o?c[0]+e.o:c[0],u=o[a]||0,l="".concat(a," ").concat(u);o[a]=u+1;var d=s(l),p={h:c[1],media:c[2],u:c[3]};-1!==d?(n[d].l++,n[d].p(p)):n.push({identifier:l,p:i(p,e),l:1}),r.push(l)}return r}function i(t,n){var s=n.m(n);return s.update(t),function(n){if(n){if(n.h===t.h&&n.media===t.media&&n.u===t.u)return;s.update(t=n)}else s.remove()}}t.exports=function(t,i){var o=e(t=t||[],i=i||{});return function(t){t=t||[];for(var r=0;r<o.length;r++){var h=s(o[r]);n[h].l--}for(var c=e(t,i),a=0;a<o.length;a++){var u=s(o[a]);0===n[u].l&&(n[u].p(),n.splice(u,1))}o=c}}},569:t=>{var n={};t.exports=function(t,s){var e=function(t){if(void 0===n[t]){var s=document.querySelector(t);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(t){s=null}n[t]=s}return n[t]}(t);if(!e)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");e.appendChild(s)}},216:t=>{t.exports=function(t){var n=document.createElement("style");return t.v(n,t.attributes),t.g(n),n}},565:(t,n,s)=>{t.exports=function(t){var n=s.M;n&&t.setAttribute("nonce",n)}},795:t=>{t.exports=function(t){var n=t.k(t);return{update:function(s){!function(t,n,s){var e=s.h,i=s.media,o=s.u;i?t.setAttribute("media",i):t.removeAttribute("media"),o&&"undefined"!=typeof btoa&&(e+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),n.O(e,t)}(n,t,s)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)}}}},589:t=>{t.exports=function(t,n){if(n.styleSheet)n.styleSheet.cssText=t;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(t))}}}},n={};function s(e){var i=n[e];if(void 0!==i)return i.exports;var o=n[e]={id:e,exports:{}};return t[e](o,o.exports,s),o.exports}s.n=t=>{var n=t&&t.$?()=>t.default:()=>t;return s.d(n,{a:n}),n},s.d=(t,n)=>{for(var e in n)s.U(n,e)&&!s.U(t,e)&&Object.defineProperty(t,e,{B:!0,get:n[e]})},s.U=(t,n)=>Object.prototype.hasOwnProperty.call(t,n);var e={};(()=>{s.d(e,{F:()=>Vt,j:()=>It,S:()=>Yt});var t=s(379),n=s.n(t),i=s(795),o=s.n(i),r=s(569),h=s.n(r),c=s(565),a=s.n(c),u=s(216),l=s.n(u),d=s(589),p=s.n(d),m=s(28),f={};f.O=p(),f.v=a(),f.g=h().bind(null,"head"),f.m=o(),f.k=l();n()(m.t,f);m.t&&m.t.T&&m.t.T;class v{constructor({name:t="",A:n=!1}={}){this.name=t,this.A=n}}class w{constructor(t=0,n=0){this.x=t,this.y=n}set(t,n){this.x=t,this.y=n}C(){return this.x+this.y}}const y={root:document.getElementById("root"),R:document.getElementById("canvas-tiles"),L:document.getElementById("canvas-pre"),P:document.getElementById("canvas-post"),q:document.getElementById("canvas-stats"),N:document.getElementById("canvas-oscillators"),X:document.getElementById("canvas-instruments"),Y:document.getElementById("menu"),I:document.getElementById("menu-button"),V:document.getElementById("menu-col"),D:document.getElementById("os"),in:document.getElementById("in"),H:document.getElementById("inspect"),J:document.getElementById("inner-inspect"),K:document.getElementById("close-inspect"),Z:document.getElementById("inspect-name"),G:document.getElementById("inspect-cost"),W:document.getElementById("inspect-notes"),_:document.getElementById("inspect-sell"),tt:document.getElementById("sell-button")},b={nt:y.R.getContext("2d"),st:y.P.getContext("2d"),et:y.P.getContext("2d"),it:y.q.getContext("2d"),ot:y.N.getContext("2d"),rt:y.X.getContext("2d")},x=t=>t-63,g=t=>t-63,M=t=>t+63,k=t=>t+63,O=t=>It.width(.5)+(t-Vt.position.x)*It.width(.07)-It.width(.035),$=t=>It.height(.5)+(Vt.position.y-t)*It.width(.07)-It.width(.035),E=t=>{const{left:n,right:s}=y.R.getBoundingClientRect();if(!(t<n||t>s)){const s=It.width()/It.width(.07),e=2*(t-n)/It.width(),i=-s/2+e*s+Vt.position.x;return Math.round(i)}},U=t=>{const{top:n,bottom:s}=y.R.getBoundingClientRect();if(!(t<n||t>s)){const e=It.height()/It.width(.07),i=2*(s-t-n)/It.height(),o=-e/2+i*e+Vt.position.y;return Math.round(o)}},B=t=>O(x(t)),F=t=>$(g(t)),j=t=>void 0===t,S=t=>{t.width=t.clientWidth*window.devicePixelRatio||1,t.height=t.clientHeight*window.devicePixelRatio||1},T=(t,n,s,e,i)=>({x:Math.cos(i)*(t-s)-Math.sin(i)*(n-e)+s,y:Math.sin(i)*(t-s)+Math.cos(i)*(n-e)+e}),A=(t,n,s)=>t*s+n*(1-s),C=t=>{const n=t/1e6;if(n>1)return n+"M";const s=t/1e3;return s>1?s+"K":t+""},R="rgba(0,0,0,0)",L="#FFFFFF",P="#272838",q="#ff4c7a",Q="#00e19e",z="#B0C4DE",N={ht:0,ct:0},X=2*Math.PI,Y="Tahoma, sans-serif",I={L:{background:P}},V=(t,n,s=!1,e=!0,i=b.nt)=>{e&&i.strokeRect(t,n,It.width(.07),It.width(.07)),s&&i.fillRect(t,n,It.width(.07),It.width(.07))},D=t=>{t.beginPath(),t.arc(It.at(0),It.ut(0),It.width(.07*6),0,X),t.clip()};const H=[{id:"in1",lt:{dt:!0,canvas:document.createElement("canvas")}},{id:"in2",lt:{dt:!0,canvas:document.createElement("canvas")}},{id:"in3",lt:{dt:!0,canvas:document.createElement("canvas")}},{id:"in4",lt:{dt:!0,canvas:document.createElement("canvas")}}];class J extends v{constructor(t={}){super(t);const{x:n,y:s,ft:e=!1,id:i=""}=t;this.id=i,this.ft=e,this.position=new w(n,s),this.vt=0,this.wt=z}}class K extends J{constructor(t){super(t),this.name="instrument",this.color=Q}init(){this.yt=(t=>{let n=0,s=0,e=0,i=0;return t.forEach((t=>{const[o,r]=t;o<n&&(n=o),o>e&&(e=o),r<s&&(s=r),r>i&&(i=r)})),{bt:n,xt:e,gt:s,Mt:i}})(this.outline),this.shape=((t,n,s)=>{const{bt:e,xt:i,gt:o,Mt:r}=s,h=[],c=new Path2D;((t,n)=>{for(let s=0;s<n.length;s++){const[e,i]=n[s];0===s?t.moveTo(e,i):t.lineTo(e,i)}})(c,n);for(let n=e;n<i;n++)for(let s=o;s<r;s++)t.isPointInPath(c,n+.5,s+.5)&&h.push([n,s+1]);return h})(b.rt,this.outline,this.yt),this.kt=this.yt.xt-this.yt.bt,this.Ot=this.yt.Mt-this.yt.gt,this.cache=H.find((({id:t})=>t===this.id)),this.ft||this.$t(),this.Et=Math.round(this.Ut/3)}Bt(){const{Ft:t,jt:n,St:s,Tt:e}=Vt.At,{x:i,y:o}=this.position,r=M(i),h=k(o),c=Yt[r][h],a=r>t&&r<n&&h>s&&h<e,u=Boolean(c.Ct),l=c.Rt||!1,d=this.shape.some((([t,n])=>Yt[r+t][h+n].Rt||Boolean(Yt[r+t][h+n].Ct)));return a&&!u&&!l&&!d}$t(){this.ft=!1;const t=M(this.position.x),n=k(this.position.y);Yt[t][n].Ct=this,this.shape.forEach((([s,e])=>{Yt[t+s][n+e].Rt=!0}))}Lt(){const t=M(this.position.x),n=k(this.position.y);Yt[t][n]=new Object,this.shape.forEach((([s,e])=>{Yt[t+s][n+e].Rt=!1}))}Pt(t=b.rt,n=!0){t.save(),t.fillStyle=this.disabled?z:this.color,t.beginPath();for(let n=0;n<this.outline.length;n++){const[s,e]=this.outline[n],i=O(this.position.x+s),o=$(this.position.y+e);0===n?t.moveTo(i,o):t.lineTo(i,o)}if(t.closePath(),t.clip(),t.fillRect(O(this.position.x-(this.kt-1)/2),$(this.position.y+(this.Ot-1)/2),It.width(.07)*this.kt,It.width(.07)*this.Ot),t.stroke(),n){const n=O(this.position.x+.5),s=$(this.position.y-.5);t.fillStyle=L,t.beginPath(),t.arc(n,s,It.width(.0175),0,X),t.fill(),t.fillStyle=P;const e=this.display.substr(0,1),i=t.measureText(e);t.fillText(this.display.substr(0,1),n,s+i.actualBoundingBoxAscent/2)}t.restore()}}class Z extends K{constructor(t={}){super(t),this.Ut=75,this.id="in4",this.display="B",this.qt=5,this.outline=[[-1,0],[0,0],[0,1],[2,1],[2,-1],[1,-1],[1,-2],[-1,-2],[-1,0]],this.init()}}const G=t=>new Float32Array(t),W=()=>Math.random(),_=(t,n,s)=>{if(s){const e=t.value;t.linearRampToValueAtTime(e,n),s.forEach((({value:s,time:e,exp:i=!1})=>{i?t.exponentialRampToValueAtTime(s,n+e):t.linearRampToValueAtTime(s,n+e)}))}},tt=t=>{let n;return n=t>0?2:.5,ht*Math.pow(Math.pow(n,1/12),Math.abs(t))},nt=(t=ot.context,n,s,e)=>{const i=t.createBiquadFilter();return i.frequency.value=s,i.type=n,e&&i.connect(e),i};class st{constructor(){this.context=new(window.AudioContext||window.webkitAudioContext)({sampleRate:44100}),this.Qt=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(2,88200,44100),this.zt=this.context.createGain(),this.Nt=this.context.createConvolver(),this.Nt.connect(this.zt)}async init(){const t=await this.Xt();this.Nt.buffer=t,this.Nt.connect(this.zt)}async Xt(){return new Promise((t=>{const n=this.Qt.createGain();n.connect(this.Qt.destination),n.gain.setValueAtTime(1,0),n.gain.exponentialRampToValueAtTime(1e-4,2);const s=nt(this.Qt,"lowpass",5e3,n),e=nt(this.Qt,"highpass",500,s),i=this.Qt.createBufferSource();i.buffer=(t=>{const n=44100*t,s=G(n),e=G(n);for(let t=0;t<n;t++)s[t]=1-2*W(),e[t]=1-2*W();const i=ot.context.createBuffer(2,n,44100);return i.getChannelData(0).set(s),i.getChannelData(1).set(e),i})(2),i.connect(e),i.start(),this.Qt.startRendering(),this.Qt.oncomplete=n=>{t(n.renderedBuffer)}}))}}st.Yt=196,st.It=2,st.Vt=44100;const et=class{constructor(){this.Dt=[],this.Ht=0}Jt(t,n){this.Ht++;const s=this.Ht,e=ot.context.createBuffer(1,1,44100),i=ot.context.createBufferSource();return i.buffer=e,i.connect(ot.context.destination),this.Dt.push({id:s,time:t,type:"single",source:i}),i.onended=()=>{n(),this.cancel(s)},i.start(t-e.duration),s}Kt(t){t.count++;const n=ot.context.createBufferSource();n.buffer=t.source.buffer,n.connect(ot.context.destination),n.onended=()=>{t.Zt(),this.Kt(t)},n.start(t.time+t.count*t.frequency-n.buffer.duration),t.source=n}Gt(t,n,s){const e=ot.context.createBuffer(1,1,44100),i=ot.context.createBufferSource();i.buffer=e,i.connect(ot.context.destination);const o={id:++this.Ht,count:0,time:t,frequency:n,type:"repeating",Zt:s,source:i};return i.onended=()=>{s(),this.Kt(o)},i.start(Math.max(0,t-e.duration)),this.Dt.push(o),o.id}Wt(t,n){const s=this._t(t);s&&(s.Zt=n,s.source.onended=()=>{n(),this.Kt(s)})}_t(t){return this.Dt.find((n=>n.id===t))}clear(){this.Dt.forEach((t=>{t.source.onended=null,t.source.stop(),t.source.disconnect()})),this.Dt.length=0}cancel(t){const n=this._t(t);if(n){n.source.onended=null;try{n.source.stop()}catch(t){}n.source.disconnect(),this.Dt=this.Dt.filter((t=>t.id!==n.id))}}},it=[0,4,5,7,10],ot=new st,rt=new et,ht=196;class ct{constructor(t={}){this.note=t.note,this.tn=0,this.nn={sn:1,en:0,on:2e4,rn:20,hn:1.7,cn:1.7,an:1.7,un:1.7}}play(t,n=this.ln()){}dn(t,n,s={}){n.gain.gain.value*=this.nn.sn;const e=ot.context.createGain();_(e.gain,t,this.pn.amplitude);const i=ot.context.createGain();i.gain.value=1-this.nn.en;const o=ot.context.createGain();o.gain.value=this.nn.en;const r=ot.context.createBiquadFilter();r.type="lowpass",r.frequency.value=2e4,r.Q.value=this.mn("lpEnvQ",s.cn);const h=ot.context.createBiquadFilter();h.type="lowpass",h.frequency.value=this.mn("lpFrequency",s.on),h.Q.value=this.mn("lpQ",s.hn);const c=ot.context.createBiquadFilter();c.type="highpass",c.frequency.value=20,c.Q.value=this.mn("hpEnvQ",s.an);const a=ot.context.createBiquadFilter();a.type="highpass",a.frequency.value=this.mn("hpFrequency",s.rn),a.Q.value=this.mn("hpQ",s.un),this.pn?.fn&&_(r.frequency,t,this.pn.fn),this.pn?.vn&&_(c.frequency,t,this.pn.vn);const{source:u,gain:l}=n;u.connect(l),l.connect(e),e.connect(r),r.connect(c),c.connect(h),h.connect(a),a.connect(o),a.connect(i),i.connect(ot.zt),o.connect(ot.Nt),u.start(t),u.stop(t+this.duration),u.onended=()=>{u.disconnect(),e.disconnect()}}wn(t,n,s,e={}){let i;const o=ot.context.createGain(),r=this.ln(s);if("waveform"===t){const{yn:t}=e;i=ot.context.createOscillator(),i.type=t,i.frequency.value=tt(r)}if("harmonics"===t){const{bn:t,yn:n}=e;if(i=ot.context.createOscillator(),i.type=n,!t)throw new Error("harmonic option required");o.gain.value=.2/(1+Math.log2(t)),i.frequency.value=tt(r)*t}if("waveform"!==t&&"harmonics"!==t||(this.duration=this.pn.amplitude?.map((({time:t})=>t)).reduce(((t,n)=>t+n))||0),"sample"===t){const{buffer:t}=e;i=ot.context.createBufferSource(),i.buffer=t,this.duration=t.duration}return{source:i,gain:o,note:s}}mn(t,n){return void 0!==n?n:this.nn[t]}ln(t){return void 0!==t?this.tn+t:void 0!==this.note?this.tn+this.note:this.tn+it[Math.floor(Math.random()*it.length)]}}class at extends ct{constructor(t={}){super(t),this.tn=-24,this.pn={amplitude:[{time:0,value:1},{time:.75,value:1e-4,exp:!0}]}}play(t,n){const s=this.wn("waveform",t,n,{yn:"sine"});this.dn(t,s)}}class ut extends K{constructor(t={}){super(t),this.display="Kick",this.id="in1",this.Ut=5,this.qt=1,this.outline=[[0,0],[1,0],[1,-1],[0,-1]],this.xn=new at({note:0}),this.init()}}class lt extends ct{constructor(t={}){super(t),this.tn=0,this.pn={amplitude:[{time:0,value:1},{time:.45,value:1e-4,exp:!0}]},this.nn.rn=90,this.nn.en=.05,this.nn.sn=.25}play(t,n=this.ln()){const s=this.wn("waveform",t,n,{yn:"sine"});s.gain.gain.value=.4;const e=this.wn("sample",t,n,{buffer:ot.Nt.buffer});e.source.detune.value=100*n,this.dn(t,s),this.dn(t,e)}}class dt extends K{constructor(t={}){super(t),this.display="Snare",this.id="in2",this.Ut=25,this.qt=5,this.outline=[[0,0],[1,0],[1,-1],[0,-1]],this.init(),this.xn=new lt({note:7})}}class pt extends J{constructor(t={}){super(t),this.name="oscillator",this.gn=[]}init(){this.ft||this.$t(),this.Et=Math.round(this.Ut/3)}Mn(){return ot.context.currentTime%this.duration/this.duration}Bt(){const{Ft:t,jt:n,St:s,Tt:e}=Vt.At,{x:i,y:o}=this.position,r=M(i),h=k(o),c=Yt[r][h],a=r>t&&r<n&&h>s&&h<e,u=Boolean(c.Ct),l=c.Rt||!1;return a&&!u&&!l}$t(){this.ft=!1,Yt[M(this.position.x)][k(this.position.y)].Ct=this,this.gn.forEach((t=>{rt.cancel(t)})),this.kn()}Lt(){const t=M(this.position.x),n=k(this.position.y);Yt[t][n]=new Object,this.gn.forEach((t=>{rt.cancel(t)}))}Pt(){const t=O(this.position.x+.5),n=$(this.position.y-.5);this.On(t,n),this.$n(t,n),this.ft&&(b.ot.globalAlpha=.5,this.En.forEach((t=>{const[n,s]=t;b.ot.beginPath(),V(O(this.position.x+n),$(this.position.y+s),!0,!1,b.ot)})),b.ot.globalAlpha=1)}$n(t,n){b.ot.moveTo(t,n);const s=this.Mn();let e,i;for(let t=0;t<this.En.length;t++){const n=(t+1)/this.En.length;if(s<n){const o=(n-s)*this.En.length;e=O(this.position.x+.5+A(this.En[t][0],this.En[(t+1)%this.En.length][0],o)),i=$(this.position.y-.5+A(this.En[t][1],this.En[(t+1)%this.En.length][1],o)),b.ot.lineTo(e,i),b.ot.stroke(),b.ot.beginPath(),b.ot.arc(e,i,It.width(.0175),0,X),b.ot.fill();break}}}On(t,n){}kn(){const t=M(this.position.x),n=k(this.position.y),s=Math.ceil(Math.max(this.Mn()||.1)*this.En.length),e=(t=>{const n=ot.context.currentTime/t;return(Math.floor(n)+1)*t})(this.interval);for(let i=0;i<this.En.length;i++){const o=e+i*this.interval,r=(i+s)%this.En.length,h=this.En[r],c=Yt[t+h[0]][n+h[1]];this.gn.push(rt.Gt(o,this.duration,(()=>{if("instrument"===c?.Ct?.name&&"playing"!==c.state){c.state="playing";const t=c.Ct,n=t.qt;this.vt+=n,N.ht+=n,N.ct+=n,t.vt+=n,c.Ct.xn.play(ot.context.currentTime),rt.Jt(ot.context.currentTime+.7714285714285714,(()=>{c.state="stopped"}))}})))}}}class mt extends pt{constructor(t={}){super(t)}init(){this.En=[[0,this.Un],[this.Un,0],[0,-this.Un],[-this.Un,0]],this.duration=this.interval*this.En.length,super.init()}On(t,n,s=b.ot,e=It.width(.035-.006),i=It.width(.006),o=(this.disabled?this.wt:this.color)){s.strokeStyle=o,s.fillStyle=o,s.lineWidth=i,s.beginPath(),s.arc(t,n,e,0,X)}$n(t,n){b.ot.moveTo(t,n);const s=T(t+It.width(.07*this.Un),n,t,n,X*this.Mn()-Math.PI/2);b.ot.lineTo(s.x,s.y),b.ot.stroke(),b.ot.beginPath(),b.ot.arc(s.x,s.y,It.width(.0175),0,X),b.ot.fill()}}class ft extends mt{constructor(t={}){super(t),this.display="Circle Oscillator",this.id="co1",this.Ut=25,this.Un=1,this.color=q,this.interval=.8571428571428571,this.init()}}const vt={screenX:void 0,screenY:void 0,Bn:void 0,Fn:void 0},wt=new class{constructor(t,n){this.x=t,this.y=n}}(9,16);class yt extends ct{constructor(t={}){super(t),this.tn=0,this.pn={amplitude:[{time:0,value:1},{time:.25,value:1e-4,exp:!0}]},this.nn.en=.05}play(t,n){const s=this.wn("sample",t,n,{buffer:ot.Nt.buffer});s.gain.gain.value=.4,s.source.detune.value=2400,this.dn(t,s)}}class bt extends K{constructor(t={}){super(t),this.display="HiHat",this.id="in3",this.Ut=5,this.qt=1,this.outline=[[0,0],[1,0],[1,-1],[0,-1]],this.xn=new yt({note:0}),this.init()}}const xt={in1:t=>new ut(t),in2:t=>new dt(t),jn:t=>new bt(t),Sn:t=>new Z(t)},gt=Object.values(xt).map((t=>t({ft:!0})));class Mt extends pt{constructor(t={}){super(t),this.width=1}On(t,n,s=b.ot,e=It.width(.07*this.width-.012),i=It.width(.006),o=(this.disabled?this.wt:this.color)){s.strokeStyle=o,s.fillStyle=o,s.lineWidth=i,s.beginPath(),s.strokeRect(t-e/2,n-e/2,e,e),s.stroke()}}class kt extends Mt{constructor(t={}){super(t),this.display="Square Oscillator",this.interval=.21428571428571427,this.id="so1",this.Ut=1e3,this.color=q,this.En=[[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1]],this.duration=this.interval*this.En.length,this.init()}}class Ot extends pt{constructor(t={}){super(t),this.width=1}On(t,n,s=b.ot,e=It.width(.07*this.width-.012),i=It.width(.006),o=(this.disabled?this.wt:this.color)){s.strokeStyle=o,s.fillStyle=o,s.lineWidth=i,s.beginPath(),((t,n,s,e)=>{const i=e*Math.sqrt(3)/2;t.beginPath(),t.moveTo(n,s-i/2),t.lineTo(n+e/2,s+i/2),t.lineTo(n-e/2,s+i/2),t.closePath()})(s,t,n,e),s.stroke()}}class $t extends Ot{constructor(t={}){super(t),this.display="Triangle Oscillator",this.interval=.5714285714285714,this.id="to1",this.Ut=50,this.color=q,this.En=[[0,1],[1,-1],[-1,-1]],this.duration=this.interval*this.En.length,this.init()}}const Et={Tn:t=>new ft(t),An:t=>new $t(t),Cn:t=>new kt(t)},Ut=Object.values(Et).map((t=>t({ft:!0})));let Bt=!1,Ft=!1;const jt=()=>{"hidden"===y.Y.style.visibility?(y.Y.style.visibility="visible",y.I.style.transform="rotate(0deg)",Bt=!0,At(),Ft&&St(),document.addEventListener("mousedown",Lt)):(y.Y.style.visibility="hidden",y.I.style.transform="rotate(45deg)",Bt=!1,document.removeEventListener("mousedown",Lt))},St=()=>{"hidden"===y.H.style.visibility?(y.H.style.visibility="visible",Ft=!0,Tt(),document.addEventListener("mousedown",Lt)):(y.H.style.visibility="hidden",Ft=!1,Vt.Rn=null,document.removeEventListener("mousedown",Lt))},Tt=()=>{if(Vt.Rn){const t=Math.round(Vt.Rn.Ut/3);y.G.innerHTML=C(Vt.Rn.Ut),y.Z.innerHTML=Vt.Rn.display,y.W.innerHTML=C(Vt.Rn.vt),y._.innerHTML=C(t)}},At=()=>{},Ct=()=>{Vt.Rn&&(Vt.Rn.Lt(),N.ht+=Vt.Rn.Et,N.ct+=Vt.Rn.Et,St())},Rt=()=>{((t=y.L,n=50,s=300)=>{const e=t.getContext("2d"),i=Math.sqrt((Math.max(t.width,t.height)/2)**2*2),o=i/150,r=i/o,h=o/5,c=t.width/2,a=t.height/2;console.log(t);for(let t=0;t<r;t++){const i=t*o,r=2*Math.PI*i,u=Math.round(r/(4*h));for(let t=0;t<u;t++){const o=t*(X/u),r=o/X+Math.random()/2,{x:l,y:d}=T(c+i,a,c,a,o);e.fillStyle=`hsl(${A(n,s,r%1)}, 50%, 50%)`,e.beginPath(),e.arc(l,d,h,0,X),e.fill()}}})(),(()=>{const t=b.et.createRadialGradient(It.at(0),It.ut(0),It.width(3*.07),It.at(0),It.ut(0),It.width(6*.07));t.addColorStop(0,R),t.addColorStop(.25,R),t.addColorStop(1,P),S(y.P),b.et.lineWidth=It.width(.006),b.et.strokeStyle=L,b.et.fillStyle=t,b.et.beginPath(),b.et.arc(It.at(0),It.ut(0),It.width(.07*6),0,X),b.et.fill(),b.et.stroke()})(),H.forEach((t=>{t.lt.dt=!0})),Vt.Ln()},Lt=t=>{!Bt||y.Y.contains(t.target)||y.I.contains(t.target)||jt(),Ft&&!y.J.contains(t.target)&&St()},Pt=t=>{"Escape"===t.key&&Bt&&jt()},qt=t=>{"Escape"===t.key&&Ft&&St()},Qt=t=>{vt.screenX=t.x,vt.screenY=t.y,vt.Bn=E(t.x),vt.Fn=U(t.y)},zt=t=>{if(ot.context.resume(),!Bt&&!Ft){const n=.07*y.R.clientWidth;let s=t.clientX,e=t.clientY;const{x:i,y:o}=Vt.position,r=t=>{const r=t.clientX-s,h=t.clientY-e;Vt.position.set(i-r/n,o+h/n),Vt.Ln()},h=()=>{document.removeEventListener("mousemove",r),document.addEventListener("mousemove",Qt)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",h,{once:!0}),document.removeEventListener("mousemove",Qt)}};document.addEventListener("mousedown",(t=>{Vt.Rn&&!Ft&&St()}),{capture:!1}),document.addEventListener("mousemove",(()=>{if(Bt||Ft)return;if(j(vt.Bn)||j(vt.Fn))return;const t=M(vt.Bn),n=k(vt.Fn);if(j(t)||j(n))return;const s=Yt[t][n];return Vt.Rn=s.Ct,s.Ct?y.q.style.cursor="pointer":y.q.style.cursor="grab",s}),{capture:!1});const Nt=()=>{[y.R,y.L,y.P,y.q,y.N,y.X,y.Y,y.H].forEach((t=>{(t=>{const n=t.parentElement;new ResizeObserver((()=>{const{width:s,height:e}=n.getBoundingClientRect(),i=Math.min(s/wt.x,e/wt.y),o=i*wt.x,r=i*wt.y,h=window.devicePixelRatio||1;t.width=o*h,t.height=r*h,t.style.width=o+"px",t.style.height=r+"px",Vt.Ln()})).observe(n)})(t)})),y.I.addEventListener("click",jt),y.K.addEventListener("click",St),y.tt.addEventListener("click",Ct),document.addEventListener("keydown",Pt),document.addEventListener("keydown",qt),document.addEventListener("mousemove",Qt),document.addEventListener("mousedown",zt);new ResizeObserver(Rt).observe(y.root)},Xt=()=>{const t=[...Ut,...gt];t.forEach(((n,s)=>{const e=n.id,i=n.name,o=document.createElement("button"),r=document.createElement("canvas");r.classList.add("full"),o.append(r),o.id=e;y["instrument"===i?"in":"D"].append(o),o.onclick=n=>{n.stopPropagation(),jt(),((t,n)=>{t.position.set(vt.Bn,vt.Fn),Vt.Pn=t,y.q.style.cursor="pointer";const s=()=>{const n=vt.Bn,s=vt.Fn;void 0!==n&&void 0!==s&&(t.position.set(n,s),t.disabled=!t.Bt())},e=()=>{if(t.disabled)document.addEventListener("click",e,{once:!0});else{const{x:e,y:i}=t.position;n({x:e,y:i}),Vt.Pn=null,document.removeEventListener("mousemove",s),y.q.style.cursor="grab"}};document.addEventListener("keydown",(t=>{"Escape"===t.key&&(Vt.Pn=null,document.removeEventListener("mousemove",s),document.removeEventListener("click",e),y.q.style.cursor="grab")})),document.addEventListener("mousemove",s),document.addEventListener("click",e,{once:!0})})(t[s],"instrument"===i?xt[e]:Et[e])};new ResizeObserver((()=>{S(r),((t,n)=>{S(t);const s=t.getContext("2d"),e=n.id.substr(0,2);if("oscillator"===n.name&&(n.On(t.width/2,t.height/1.75,s,t.width*("co"===e?.15:.3),t.width/15),s.stroke()),"instrument"===n.name){const e=n;t.width=y.X.width,t.height=y.X.height;const i=5/Math.max(e.kt,e.Ot),{x:o,y:r}=wt;s.save(),s.setTransform(i,0,0,i*r/o,-(i-1)*t.width/2,-(i*r/o-1)*t.height/2),n.Pt(s,!1),s.restore(),s.scale(1,r/o)}s.font=`${t.width/5}px ${Y}`,s.fillStyle=L,s.textAlign="center";const i=C(n.Ut),o=s.measureText(i);s.fillText(i,t.width/2,1.75*o.actualBoundingBoxAscent)})(r,n)})).observe(o)}))},Yt=Array.from({length:127}).map((()=>Array.from({length:127},Object))),It=new class{constructor(t){this.canvas=t}at(t){return this.canvas.width*((t+1)/2)}ut(t){return this.canvas.height*((t+1)/2)}width(t=1){return this.canvas.width*t}height(t=1){return this.canvas.height*t}}(y.R),Vt=new class extends v{constructor({name:t="camera",coords:n}){super({name:t}),this.coords=n,this.position=new w,this.qn=new w,this.At={Ft:void 0,jt:void 0,St:void 0,Tt:void 0},this.Qn()}Qn(){const t=Math.round(this.position.x),n=Math.round(this.position.y);this.At={Ft:Math.max(0,M(t-6)),jt:Math.min(126,M(t+6)),St:Math.max(0,k(n-6)),Tt:Math.min(126,k(n+6))}}Ln(){console.log("viewports"),this.Qn(),S(y.R),b.nt.fillStyle=P,b.nt.strokeStyle=L,b.nt.lineWidth=It.width(.006),D(b.nt),b.nt.fillRect(0,0,It.width(),It.height()),Vt.zn(((t,n,s)=>{V(B(n),F(s))}))}zn(t){for(let n=this.At.Ft;n<=this.At.jt;n++)for(let s=this.At.St;s<=this.At.Tt;s++)t(Yt[n][s],n,s)}Pt(){(()=>{S(y.q),b.it.font=`${It.width(.10500000000000001)}px ${Y}`,b.it.fillStyle=L,b.it.textAlign="center";const t=b.it.measureText("SPACE JAM");b.it.font=`${It.width(.10500000000000001)}px ${Y}`;const n="Current: "+C(N.ht);b.it.font=`${It.width(.07)}px ${Y}`,b.it.fillText(n,It.at(0),It.ut(-.85)+2*t.actualBoundingBoxAscent);const s=`(x: ${Math.round(Vt.position.x)}, y: ${Math.round(Vt.position.y)})`;b.it.font=`${It.width(.035)}px ${Y}`,b.it.fillText(s,It.at(0),It.ut(-.85)+3*t.actualBoundingBoxAscent)})(),this.zn(((t,n,s)=>{const{Ct:e,state:i}=t;"instrument"===e?.name&&"playing"===i&&((t,n,s,e,i)=>{const o=n.width(.0175*1.1);t.fillStyle=P,t.globalAlpha=1,t.beginPath(),t.arc(s,e,o,0,X),t.fill(),t.globalAlpha=1,t.font=`${n.width(.0175)}px ${Y}`,t.textAlign="center",t.fillStyle=L;const r="+"+i,h=t.measureText(r);t.fillText(r,s,e+h.actualBoundingBoxAscent/2)})(b.it,this.coords,O(x(n)+.5),$(g(s)-.5),e.qt)})),S(y.N),b.ot.lineCap="round",b.ot.lineJoin="round",b.ot.lineWidth=It.width(.006),D(b.ot),Vt.zn((({Ct:t})=>{"oscillator"===t?.name&&t.Pt()})),S(y.X),b.rt.font=`${It.width(.0175)}px ${Y}`,b.rt.textAlign="center",b.rt.fillStyle=P,b.rt.strokeStyle=L,b.rt.lineWidth=It.width(.006),b.rt.lineJoin="round",D(b.rt),Vt.zn((({Ct:t})=>{"instrument"===t?.name&&t.Pt()})),this.Pn?.Pt()}}({coords:It});(async()=>{await ot.init(),Nt(),Xt(),Object.entries(y).forEach((([t,n])=>{Object.assign(n.style,I[t])})),document.body.style.background="black",At(),Vt.Ln(),new ut({x:1,y:0}),new dt({x:-1,y:0}),new Z({x:-4,y:-4}),new ft({x:0,y:0});let t=0;const n=s=>{Vt.Pt(),(Bt||Ft)&&N.ht!==t&&(At(),Tt()),t=N.ht,window.requestAnimationFrame(n)};window.requestAnimationFrame(n)})()})()})();</script></body></html>