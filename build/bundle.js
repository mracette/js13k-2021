(()=>{var t={466:function(t){var n;t.exports=((n=function(){function t(t){return r.appendChild(t.dom),t}function e(t){for(var n=0;n<r.children.length;n++)r.children[n].style.display=n===t?"block":"none";o=t}var o=0,r=document.createElement("div");r.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",(function(t){t.preventDefault(),e(++o%r.children.length)}),!1);var i=(performance||Date).now(),c=i,s=0,a=t(new n.Panel("FPS","#0ff","#002")),u=t(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=t(new n.Panel("MB","#f08","#201"));return e(0),{REVISION:16,dom:r,addPanel:t,showPanel:e,begin:function(){i=(performance||Date).now()},end:function(){s++;var t=(performance||Date).now();if(u.update(t-i,200),t>c+1e3&&(a.update(1e3*s/(t-c),100),c=t,s=0,l)){var n=performance.memory;l.update(n.usedJSHeapSize/1048576,n.jsHeapSizeLimit/1048576)}return t},update:function(){i=this.end()},domElement:r,setMode:e}}).Panel=function(t,n,e){var o=1/0,r=0,i=Math.round,c=i(window.devicePixelRatio||1),s=80*c,a=48*c,u=3*c,l=2*c,f=3*c,p=15*c,h=74*c,d=30*c,y=document.createElement("canvas");y.width=s,y.height=a,y.style.cssText="width:80px;height:48px";var v=y.getContext("2d");return v.font="bold "+9*c+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=e,v.fillRect(0,0,s,a),v.fillStyle=n,v.fillText(t,u,l),v.fillRect(f,p,h,d),v.fillStyle=e,v.globalAlpha=.9,v.fillRect(f,p,h,d),{dom:y,update:function(a,m){o=Math.min(o,a),r=Math.max(r,a),v.fillStyle=e,v.globalAlpha=1,v.fillRect(0,0,s,p),v.fillStyle=n,v.fillText(i(a)+" "+t+" ("+i(o)+"-"+i(r)+")",u,l),v.drawImage(y,f+c,p,h-c,d,f,p,h-c,d),v.fillRect(f+h-c,p,c,d),v.fillStyle=e,v.globalAlpha=.9,v.fillRect(f+h-c,p,c,i((1-a/m)*d))}}},n)}},n={};function e(o){var r=n[o];if(void 0!==r)return r.exports;var i=n[o]={exports:{}};return t[o].call(i.exports,i,i.exports,e),i.exports}e.d=(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},e.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n);var o={};(()=>{"use strict";e.d(o,{bl:()=>Yt,a9:()=>Xt,Aq:()=>Wt});var t=function(){function t(t){this.canvas=t}return t.prototype.nx=function(t){return this.canvas.width*((t+1)/2)},t.prototype.ny=function(t){return this.canvas.height*((t+1)/2)},t.prototype.width=function(t){return void 0===t&&(t=1),this.canvas.width*t},t.prototype.height=function(t){return void 0===t&&(t=1),this.canvas.height*t},t}(),n=0,r=function(t){var e=(void 0===t?{}:t).name,o=void 0===e?"":e;this.name=o,this.uuid=n,n+=1},i=function(){function t(t,n){void 0===t&&(t=0),void 0===n&&(n=0),this.x=t,this.y=n}return t.prototype.set=function(t,n){this.x=t,this.y=n},t.prototype.sum=function(){return this.x+this.y},t}(),c=function(t){return new Float32Array(t)},s=function(){return Math.random()},a=function(t,n,e,o){void 0===t&&(t=y.context);var r=t.createBiquadFilter();return r.frequency.value=e,r.type=n,o&&r.connect(o),r},u=function(t,n,e,o){return new(e||(e=Promise))((function(r,i){function c(t){try{a(o.next(t))}catch(t){i(t)}}function s(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var n;t.done?r(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(c,s)}a((o=o.apply(t,n||[])).next())}))},l=function(t,n){var e,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;c;)try{if(e=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=n.call(t,c)}catch(t){i=[6,t],o=0}finally{e=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},f=function(){function t(){this.context=new(window.AudioContext||window.webkitAudioContext),this.offline=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(2,88200,44100),this.premaster=this.context.createGain(),this.premaster.connect(this.context.destination),this.reverb=this.context.createConvolver(),this.reverb.connect(this.premaster)}return t.prototype.init=function(){return u(this,void 0,void 0,(function(){var t;return l(this,(function(n){switch(n.label){case 0:return[4,this.renderReverbTail()];case 1:return t=n.sent(),this.reverb.buffer=t,this.reverb.connect(this.premaster),[2]}}))}))},t.prototype.renderReverbTail=function(){return u(this,void 0,void 0,(function(){var t=this;return l(this,(function(n){return[2,new Promise((function(n){var e=t.offline.createGain();e.connect(t.offline.destination),e.gain.setValueAtTime(1,0),e.gain.exponentialRampToValueAtTime(1e-4,2);var o=a(t.offline,"lowpass",5e3,e),r=a(t.offline,"highpass",500,o),i=t.offline.createBufferSource();i.buffer=function(t){for(var n=88200,e=c(n),o=c(n),r=0;r<n;r++)e[r]=1-2*s(),o[r]=1-2*s();var i=y.context.createBuffer(2,n,44100);return i.getChannelData(0).set(e),i.getChannelData(1).set(o),i}(),i.connect(r),i.start(),t.offline.startRendering(),t.offline.oncomplete=function(t){n(t.renderedBuffer)}}))]}))}))},t.baseNote=196,t.reverbTime=2,t.sr=44100,t}();const p=function(){function t(){this.queue=[],this.nextEventId=0}return t.prototype.scheduleOnce=function(t,n){var e=this;this.nextEventId++;var o=this.nextEventId,r=y.context.createBuffer(1,1,44100),i=y.context.createBufferSource();return i.buffer=r,i.connect(y.context.destination),this.queue.push({id:o,time:t,type:"single",source:i}),i.onended=function(){n(),e.cancel(o)},i.start(t-r.duration),o},t.prototype.incrementRepeating=function(t){var n=this;t.count++;var e=y.context.createBufferSource();e.buffer=t.source.buffer,e.connect(y.context.destination),e.onended=function(){t.callback(),n.incrementRepeating(t)},e.start(t.time+t.count*t.frequency-e.buffer.duration),t.source=e},t.prototype.scheduleRepeating=function(t,n,e){var o=this,r=y.context.createBuffer(1,1,44100),i=y.context.createBufferSource();i.buffer=r,i.connect(y.context.destination);var c={id:++this.nextEventId,count:0,time:t,frequency:n,type:"repeating",callback:e,source:i};return i.onended=function(){e(),o.incrementRepeating(c)},i.start(Math.max(0,t-r.duration)),this.queue.push(c),c.id},t.prototype.updateCallback=function(t,n){var e=this,o=this.getEvent(t);o&&(o.callback=n,o.source.onended=function(){n(),e.incrementRepeating(o)})},t.prototype.getEvent=function(t){return this.queue.find((function(n){return n.id===t}))},t.prototype.clear=function(){this.queue.forEach((function(t){t.source.onended=null,t.source.stop(),t.source.disconnect()})),this.queue.length=0},t.prototype.cancel=function(t){var n=this.getEvent(t);if(n){n.source.onended=null;try{n.source.stop()}catch(t){}n.source.disconnect(),this.queue=this.queue.filter((function(t){return t.id!==n.id}))}},t}();var h,d,y=new f,v=new p,m={canvasTiles:document.getElementById("canvas-tiles"),canvasPre:document.getElementById("canvas-pre"),canvasPost:document.getElementById("canvas-post"),canvasStats:document.getElementById("canvas-stats"),canvasOscillators:document.getElementById("canvas-oscillators"),canvasInstruments:document.getElementById("canvas-instruments"),menuButton:document.getElementById("menu-button"),menuCol:document.getElementById("menu-col"),menu:document.getElementById("menu"),co:document.getElementById("co"),to:document.getElementById("to"),so:document.getElementById("so"),t1:document.getElementById("t1")},w={tiles:m.canvasTiles.getContext("2d"),pre:m.canvasPost.getContext("2d"),post:m.canvasPost.getContext("2d"),stats:m.canvasStats.getContext("2d"),oscillator:m.canvasOscillators.getContext("2d"),instrument:m.canvasInstruments.getContext("2d")},g=function(t){return t+127},b=function(t){return t+127},x=function(t){return Xt.width(.5)+(t-Yt.position.x)*Xt.width(.05)-Xt.width(.025)},_=function(t){return Xt.height(.5)+(Yt.position.y-t)*Xt.width(.05)-Xt.width(.025)},O=function(t){return x(function(t){return t-127}(t))},E=function(t){return _(function(t){return t-127}(t))},P=function(t){t.width=t.clientWidth*window.devicePixelRatio||1,t.height=t.clientHeight*window.devicePixelRatio||1},B=function(t,n,e,o,r){return{x:Math.cos(r)*(t-e)-Math.sin(r)*(n-o)+e,y:Math.sin(r)*(t-e)+Math.cos(r)*(n-o)+o}},S=function(t,n,e){return t*e+n*(1-e)},j="rgba(0,0,0,0)",T="#FFFFFF",A="#272838",C="#ff4c7a",k="#00f9ff",q="#00e19e",M="#B0C4DE",R={notes:0},I=2*Math.PI,L=function(t,n,e,o,r){void 0===e&&(e=!1),void 0===o&&(o=!0),void 0===r&&(r=w.tiles),o&&r.strokeRect(t,n,Xt.width(.05),Xt.width(.05)),e&&r.fillRect(t,n,Xt.width(.05),Xt.width(.05))},U=function(t){t.beginPath(),t.arc(Xt.nx(0),Xt.ny(0),Xt.width(.45),0,I),t.clip()},W=(h=function(t,n){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(t,n)},function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=t}h(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}),X=function(t){function n(n){var e=n.name,o=void 0===e?"camera":e,r=n.coords,c=t.call(this,{name:o})||this;return c.coords=r,c.position=new i,c.velocity=new i,c.entityArrayBounds={xLower:void 0,xUpper:void 0,yLower:void 0,yUpper:void 0},c.updateEntityArrayBounds(),c}return W(n,t),n.prototype.updateEntityArrayBounds=function(){var t=Math.round(this.position.x),n=Math.round(this.position.y);this.entityArrayBounds.xLower=Math.max(0,g(t-9)),this.entityArrayBounds.xUpper=Math.min(254,g(t+9)),this.entityArrayBounds.yLower=Math.max(0,b(n-9)),this.entityArrayBounds.yUpper=Math.min(254,b(n+9))},n.prototype.move=function(t,n,e){void 0===e&&(e=0),this.position.x-=t,this.position.y+=n,this.updateEntityArrayBounds(),P(m.canvasTiles),w.tiles.fillStyle=A,w.tiles.strokeStyle=T,w.tiles.lineWidth=Xt.width(.006),U(w.tiles),w.tiles.fillRect(0,0,Xt.width(),Xt.height()),Yt.applyToEntityArray((function(t,n,e){L(O(n),E(e))})),this.velocity.sum()&&this.decelerate(e)},n.prototype.decelerate=function(t){var n=this;["x","y"].forEach((function(e){var o=n.velocity[e]<0?1:-1;n.velocity[e]+=o*t*.5,Math.abs(n.velocity[e])<.01&&(n.velocity[e]=0)}))},n.prototype.applyToEntityArray=function(t){for(var n=this.entityArrayBounds.xLower;n<=this.entityArrayBounds.xUpper;n++)for(var e=this.entityArrayBounds.yLower;e<=this.entityArrayBounds.yUpper;e++)t(Wt[n][e],n,e)},n.prototype.render=function(){var t,n=this;!function(){P(m.canvasStats),w.stats.font=Xt.width(.035)+"px sans-serif",w.stats.fillStyle=T;var t="Notes: "+R.notes;w.stats.fillText(t,Xt.nx(-.95),Xt.ny(-.95))}(),this.applyToEntityArray((function(t,e,o){var r=t.stateEndsTime,i=t.entity,c=t.state;"instrument"===(null==i?void 0:i.name)&&("playing"===c&&function(t,n,e,o,r){var i=n.width(.02),c=n.width(.05);t.fillStyle="black",t.globalAlpha=.5,t.beginPath(),t.globalAlpha=1,t.font=i+"px sans-serif",t.textAlign="center";var s="+"+r,a=t.measureText(s);t.fillText(s,e+c/2,o+c/2+a.actualBoundingBoxAscent/2)}(w.stats,n.coords,O(e),E(o),i.notes),r<=y.context.currentTime&&"playing"===c&&(t.state="stopped"))})),P(m.canvasOscillators),w.oscillator.lineCap="round",w.oscillator.lineJoin="round",w.oscillator.lineWidth=Xt.width(.006),U(w.oscillator),Yt.applyToEntityArray((function(t){var n=t.entity;"oscillator"===(null==n?void 0:n.name)&&n.render()})),P(m.canvasInstruments),w.instrument.fillStyle=A,w.instrument.strokeStyle=T,w.instrument.lineWidth=Xt.width(.006),w.instrument.lineJoin="round",U(w.instrument),Yt.applyToEntityArray((function(t){var n=t.entity;"instrument"===(null==n?void 0:n.name)&&n.render()})),null===(t=this.previewEntity)||void 0===t||t.render()},n}(r),Y=[{id:"t11",offscreen:{needsUpdate:!0,canvas:new OffscreenCanvas(0,0)}},{id:"t12",offscreen:{needsUpdate:!0,canvas:new OffscreenCanvas(0,0)}},{id:"t13",offscreen:{needsUpdate:!0,canvas:new OffscreenCanvas(0,0)}}],D=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),F=function(t){function n(n){void 0===n&&(n={});var e=t.call(this,n)||this,o=n.x,r=n.y,c=n.preview,s=void 0!==c&&c,a=n.id,u=void 0===a?"":a;return e.id=u,e.preview=s,e.position=new i(o,r),e}return D(n,t),n}(r),H=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),z=function(t){function n(n){var e=t.call(this,n)||this;return e.name="instrument",e}return H(n,t),n.prototype.init=function(){var t,n,e,o,r,i=this;this.boundingBox=(t=this.outline,n=0,e=0,o=0,r=0,t.forEach((function(t){var i=t[0],c=t[1];i<n&&(n=i),i>o&&(o=i),c<e&&(e=c),c>r&&(r=c)})),{minX:n,maxX:o,minY:e,maxY:r}),this.shape=function(t,n,e){var o=e.minX,r=e.maxX,i=e.minY,c=e.maxY,s=[],a=new Path2D;!function(t,n){for(var e=0;e<n.length;e++){var o=n[e],r=o[0],i=o[1];0===e?t.moveTo(r,i):t.lineTo(r,i)}}(a,n);for(var u=o;u<r;u++)for(var l=i;l<c;l++)t.isPointInPath(a,u+.5,l+.5)&&s.push([u,l+1]);return s}(w.instrument,this.outline,this.boundingBox),this.boundingBoxWidth=this.boundingBox.maxX-this.boundingBox.minX,this.boundingBoxHeight=this.boundingBox.maxY-this.boundingBox.minY,this.cache=Y.find((function(t){return t.id===i.id})),this.preview||this.placeOnMap()},n.prototype.fitsInMap=function(){var t=Yt.entityArrayBounds,n=t.xLower,e=t.xUpper,o=t.yLower,r=t.yUpper,i=this.position,c=i.x,s=i.y,a=g(c),u=b(s),l=Wt[a][u],f=a>n&&a<e&&u>o&&u<r,p=Boolean(l.entity),h=l.blocked||!1,d=this.shape.some((function(t){var n=t[0],e=t[1];return Wt[a+n][u+e].blocked||Boolean(Wt[a+n][u+e].entity)}));return f&&!p&&!h&&!d},n.prototype.placeOnMap=function(){this.preview=!1;var t=g(this.position.x),n=b(this.position.y);Wt[t][n].entity=this,this.shape.forEach((function(e){var o=e[0],r=e[1];Wt[t+o][n+r].blocked=!0}))},n.prototype.render=function(t){void 0===t&&(t=w.instrument),t.fillStyle=this.disabled?M:A,t.beginPath();for(var n=0;n<this.outline.length;n++){var e=this.outline[n],o=e[0],r=e[1],i=x(this.position.x+o),c=_(this.position.y+r);0===n?t.moveTo(i,c):t.lineTo(i,c)}t.closePath(),t.fill(),t.globalCompositeOperation="source-atop",this.cache.offscreen.needsUpdate&&(this.cache.offscreen.canvas.width=this.boundingBoxWidth*Xt.width(.05),this.cache.offscreen.canvas.height=this.boundingBoxHeight*Xt.width(.05),function(t){var n=t.getContext("2d");n.fillStyle="#3f415b",n.fillRect(0,0,t.width,t.height)}(this.cache.offscreen.canvas),this.cache.offscreen.needsUpdate=!1),this.disabled||t.drawImage(this.cache.offscreen.canvas,x(this.position.x-(this.boundingBoxWidth-1)/2),_(this.position.y+(this.boundingBoxHeight-1)/2)),t.globalCompositeOperation="source-over",t.stroke(),t.fillStyle=T,t.beginPath(),t.arc(x(this.position.x+.5),_(this.position.y-.5),Xt.width(.0125),0,I),t.fill(),t.fillStyle=A},n}(F),G=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),V=function(t){function n(n){void 0===n&&(n={});var e=t.call(this,n)||this;return e.id="t11",e.cost=5,e.notes=1,e.outline=[[0,0],[1,0],[1,-1],[0,-1]],e.init(),e}return G(n,t),n}(z),J=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),N=function(t){function n(n){void 0===n&&(n={});var e=t.call(this,n)||this;return e.name="oscillator",e.repeatingEvents=[],e.colorDisabled=M,e}return J(n,t),n.prototype.init=function(){this.preview||this.placeOnMap()},n.prototype.getCyclePosition=function(){return y.context.currentTime%this.duration/this.duration},n.prototype.fitsInMap=function(){var t=Yt.entityArrayBounds,n=t.xLower,e=t.xUpper,o=t.yLower,r=t.yUpper,i=this.position,c=i.x,s=i.y,a=g(c),u=b(s),l=Wt[a][u],f=a>n&&a<e&&u>o&&u<r,p=Boolean(l.entity),h=l.blocked||!1;return f&&!p&&!h},n.prototype.placeOnMap=function(){this.preview=!1,Wt[g(this.position.x)][b(this.position.y)].entity=this,this.repeatingEvents.forEach((function(t){v.cancel(t)})),this.createRepeatingEvents()},n.prototype.render=function(){var t=this,n=x(this.position.x+.5),e=_(this.position.y-.5);this.renderBaseShape(n,e),this.renderArm(n,e),this.preview&&(w.oscillator.globalAlpha=.5,this.sequence.forEach((function(n){var e=n[0],o=n[1];w.oscillator.beginPath(),L(x(t.position.x+e),_(t.position.y+o),!0,!1,w.oscillator)})),w.oscillator.globalAlpha=1)},n.prototype.renderArm=function(t,n){w.oscillator.moveTo(t,n);for(var e,o,r=this.getCyclePosition(),i=0;i<this.sequence.length;i++){var c=(i+1)/this.sequence.length;if(r<c){var s=(c-r)*this.sequence.length;e=x(this.position.x+.5+S(this.sequence[i][0],this.sequence[(i+1)%this.sequence.length][0],s)),o=_(this.position.y-.5+S(this.sequence[i][1],this.sequence[(i+1)%this.sequence.length][1],s)),w.oscillator.lineTo(e,o),w.oscillator.stroke(),w.oscillator.beginPath(),w.oscillator.arc(e,o,Xt.width(.0125),0,I),w.oscillator.fill();break}}},n.prototype.renderBaseShape=function(t,n){},n.prototype.createRepeatingEvents=function(){var t=g(this.position.x),n=b(this.position.y);console.log(this.getCyclePosition(),this.sequence.length);for(var e,o,r=Math.ceil(Math.max(this.getCyclePosition()||.1)*this.sequence.length),i=(e=this.interval,o=y.context.currentTime/e,(Math.floor(o)+1)*e),c=function(e){var o=i+e*s.interval,c=(e+r)%s.sequence.length,a=s.sequence[c],u=Wt[t+a[0]][n+a[1]];s.repeatingEvents.push(v.scheduleRepeating(o,s.duration,(function(){var t;"instrument"===(null===(t=null==u?void 0:u.entity)||void 0===t?void 0:t.name)&&"playing"!==u.state&&(u.state="playing",u.stateEndsTime=y.context.currentTime+.7714285714285714,R.notes+=u.entity.notes)})))},s=this,a=0;a<this.sequence.length;a++)c(a)},n}(F),K=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),Q=function(t){function n(n){return void 0===n&&(n={}),t.call(this,n)||this}return K(n,t),n.prototype.init=function(){this.sequence=[[0,this.radius],[this.radius,0],[0,-this.radius],[-this.radius,0]],this.duration=this.interval*this.sequence.length,t.prototype.init.call(this)},n.prototype.renderBaseShape=function(t,n,e,o,r,i){void 0===e&&(e=w.oscillator),void 0===o&&(o=Xt.width(.025-.006)),void 0===r&&(r=Xt.width(.006)),void 0===i&&(i=this.disabled?this.colorDisabled:this.color),e.strokeStyle=i,e.fillStyle=i,e.lineWidth=r,e.beginPath(),e.arc(t,n,o,0,I)},n.prototype.renderArm=function(t,n){w.oscillator.moveTo(t,n);var e=B(t+Xt.width(.05*this.radius),n,t,n,I*this.getCyclePosition()-Math.PI/2);w.oscillator.lineTo(e.x,e.y),w.oscillator.stroke(),w.oscillator.beginPath(),w.oscillator.arc(e.x,e.y,Xt.width(.0125),0,I),w.oscillator.fill()},n}(N),Z=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),$=function(t){function n(n){void 0===n&&(n={});var e=t.call(this,n)||this;return e.id="co1",e.cost=25,e.radius=1,e.color=C,e.interval=.8571428571428571,e.init(),e}return Z(n,t),n}(Q),tt={screenX:void 0,screenY:void 0,mapX:void 0,mapY:void 0},nt=new function(t,n){this.x=9,this.y=16}(9,16),et=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),ot=function(t){function n(n){void 0===n&&(n={});var e=t.call(this,n)||this;return e.cost=25,e.id="t12",e.notes=5,e.outline=[[-1,1],[2,1],[2,-2],[-1,-2]],e.init(),e}return et(n,t),n}(z),rt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),it=function(t){function n(n){void 0===n&&(n={});var e=t.call(this,n)||this;return e.cost=75,e.id="t13",e.notes=5,e.outline=[[-1,0],[0,0],[0,1],[2,1],[2,-1],[1,-1],[1,-2],[-1,-2],[-1,0]],e.init(),e}return rt(n,t),n}(z),ct={t11:function(t){return new V(t)},t12:function(t){return new ot(t)},t13:function(t){return new it(t)}},st=Object.values(ct).map((function(t){return t({preview:!0})})),at=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),ut=function(t){function n(n){void 0===n&&(n={});var e=t.call(this,n)||this;return e.id="co2",e.cost=250,e.radius=2,e.interval=1.7142857142857142,e.color=q,e.init(),e}return at(n,t),n}(Q),lt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),ft=function(t){function n(n){void 0===n&&(n={});var e=t.call(this,n)||this;return e.id="co3",e.cost=2500,e.radius=3,e.interval=3.4285714285714284,e.color=k,e.init(),e}return lt(n,t),n}(Q),pt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),ht=function(t){function n(n){void 0===n&&(n={});var e=t.call(this,n)||this;return e.width=1,e}return pt(n,t),n.prototype.renderBaseShape=function(t,n,e,o,r,i){void 0===e&&(e=w.oscillator),void 0===o&&(o=Xt.width(.05*this.width-.012)),void 0===r&&(r=Xt.width(.006)),void 0===i&&(i=this.disabled?this.colorDisabled:this.color),e.strokeStyle=i,e.fillStyle=i,e.lineWidth=r,e.beginPath(),e.strokeRect(t-o/2,n-o/2,o,o),e.stroke()},n}(N),dt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),yt=function(t){function n(n){void 0===n&&(n={});var e=t.call(this,n)||this;return e.interval=.21428571428571427,e.id="so1",e.cost=1e3,e.color=C,e.sequence=[[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1]],e.duration=e.interval*e.sequence.length,e.init(),e}return dt(n,t),n}(ht),vt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),mt=function(t){function n(n){void 0===n&&(n={});var e=t.call(this,n)||this;return e.interval=.42857142857142855,e.id="so2",e.cost=1e4,e.color=q,e.sequence=[[0,2],[2,2],[2,0],[2,-2],[0,-2],[-2,-2],[-2,0],[-2,2]],e.duration=e.interval*e.sequence.length,e.init(),e}return vt(n,t),n}(ht),wt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),gt=function(t){function n(n){void 0===n&&(n={});var e=t.call(this,n)||this;return e.interval=.42857142857142855,e.id="so3",e.cost=1e5,e.color=k,e.sequence=[[0,3],[3,3],[3,0],[3,-3],[0,-3],[-3,-3],[-3,0],[-3,3]],e.duration=e.interval*e.sequence.length,e.init(),e}return wt(n,t),n}(ht),bt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),xt=function(t){function n(n){void 0===n&&(n={});var e=t.call(this,n)||this;return e.width=1,e}return bt(n,t),n.prototype.renderBaseShape=function(t,n,e,o,r,i){void 0===e&&(e=w.oscillator),void 0===o&&(o=Xt.width(.05*this.width-.012)),void 0===r&&(r=Xt.width(.006)),void 0===i&&(i=this.disabled?this.colorDisabled:this.color),e.strokeStyle=i,e.fillStyle=i,e.lineWidth=r,e.beginPath(),function(t,n,e,o){var r=o*Math.sqrt(3)/2;t.beginPath(),t.moveTo(n,e-r/2),t.lineTo(n+o/2,e+r/2),t.lineTo(n-o/2,e+r/2),t.closePath()}(e,t,n,o),e.stroke()},n}(N),_t=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),Ot=function(t){function n(n){void 0===n&&(n={});var e=t.call(this,n)||this;return e.interval=.5714285714285714,e.id="to1",e.cost=50,e.color=C,e.sequence=[[0,1],[1,-1],[-1,-1]],e.duration=e.interval*e.sequence.length,e.init(),e}return _t(n,t),n}(xt),Et=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),Pt=function(t){function n(n){void 0===n&&(n={});var e=t.call(this,n)||this;return e.interval=1.1428571428571428,e.id="to2",e.cost=500,e.color=q,e.sequence=[[0,2],[2,-2],[-2,-2]],e.duration=e.interval*e.sequence.length,e.init(),e}return Et(n,t),n}(xt),Bt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),St=function(t){function n(n){void 0===n&&(n={});var e=t.call(this,n)||this;return e.interval=2.2857142857142856,e.id="to3",e.cost=5e3,e.color=k,e.sequence=[[0,3],[3,-3],[-3,-3]],e.duration=e.interval*e.sequence.length,e.init(),e}return Bt(n,t),n}(xt),jt={co1:function(t){return new $(t)},co2:function(t){return new ut(t)},co3:function(t){return new ft(t)},to1:function(t){return new Ot(t)},to2:function(t){return new Pt(t)},to3:function(t){return new St(t)},so1:function(t){return new yt(t)},so2:function(t){return new mt(t)},so3:function(t){return new gt(t)}},Tt=Object.values(jt).map((function(t){return t({preview:!0})})),At=function(t,n){for(var e=0,o=n.length,r=t.length;e<o;e++,r++)t[r]=n[e];return t},Ct=!1,kt=function(){"hidden"===m.menu.style.visibility?(m.menu.style.visibility="visible",m.menuButton.style.transform="rotate(45deg)",Ct=!0,qt()):(m.menu.style.visibility="hidden",m.menuButton.style.transform="rotate(0deg)",Ct=!1)},qt=function(){At(At([],st),Tt).forEach((function(t){var n=document.getElementById(t.id);t.cost<=R.notes?n.disabled&&(n.disabled=!1):n.disabled||(n.disabled=!0)}))},Mt=function(t){return t.type.startsWith("touch")?"touch":t.type.startsWith("mouse")?"mouse":t.type.startsWith("click")?"click":void 0},Rt=function(t){var n,e,o=Mt(t);if("touch"===o){var r=t;n=null==r?void 0:r.touches[0].clientX,e=null==r?void 0:r.touches[0].clientY}else if("mouse"===o||"click"===o){var i=t;n=i.pageX,e=i.pageY}return{x:n,y:e}},It={menuButton:{margin:"20px",border:"1px solid white",position:"absolute",width:"60px",height:"60px",borderRadius:"50%",background:"rgba(255, 255, 255, 0.1)",fontSize:"24px",alignSelf:"flex-end",transitionDuration:"250ms"},menu:{visibility:"hidden",background:"rgba(0,0,0,.75)",justifyContent:"flex-start"},menuCol:{justifyContent:"flex-start"},canvasPre:{background:A},co:{width:"unset"},to:{width:"unset"},so:{width:"unset"}},Lt=function(t,n){for(var e=0,o=n.length,r=t.length;e<o;e++,r++)t[r]=n[e];return t},Ut=e(466),Wt=Array.from({length:255}).map((function(){return Array.from({length:255},Object)})),Xt=new t(m.canvasTiles),Yt=new X({coords:Xt});!function(){[m.canvasTiles,m.canvasPre,m.canvasPost,m.canvasStats,m.canvasOscillators,m.canvasInstruments,m.menu].forEach((function(t){!function(t){var n=t.parentElement;new ResizeObserver((function(){var e=n.getBoundingClientRect(),o=e.width,r=e.height,i=Math.min(o/nt.x,r/nt.y),c=i*nt.x,s=i*nt.y,a=window.devicePixelRatio||1;t.width=c*a,t.height=s*a,t.style.width=c+"px",t.style.height=s+"px"})).observe(n)}(t)})),m.menuButton.onclick=kt;var t=function(t){tt.screenX=t.x,tt.screenY=t.y,tt.mapX=function(t){var n=m.canvasTiles.getBoundingClientRect(),e=n.left,o=n.right;if(!(t<e||t>o)){var r=Xt.width()/Xt.width(.05),i=-r/2+2*(t-e)/Xt.width()*r+Yt.position.x;return Math.round(i)}}(t.x),tt.mapY=function(t){var n=m.canvasTiles.getBoundingClientRect(),e=n.top,o=n.bottom;if(!(t<e||t>o)){var r=Xt.height()/Xt.width(.05),i=-r/2+2*(o-t-e)/Xt.height()*r+Yt.position.y;return Math.round(i)}}(t.y)},n=[].fill(0,0,4),e=[].fill(0,0,4),o=function(o){if(y.context.resume(),!Ct){var r=Rt(o),i=r.x,c=r.y,s=Mt(o),a=function(t){var o=function(t,n,e,o,r){var i=Rt(t);return{x:(i.x-e)/n,y:(i.y-r)/o}}(t,m.canvasTiles.clientWidth,i,m.canvasTiles.clientHeight,c),r=o.x,s=o.y;(n.length=4)&&n.shift(),(e.length=4)&&e.shift(),n.push(r),e.push(s),Yt.move(r,s)},u=function(){document.removeEventListener("mousemove",a),document.removeEventListener("touchmove",a),document.addEventListener("mousemove",t),Yt.velocity.x=n.reduce((function(t,n){return t+n}))/4,Yt.velocity.y=e.reduce((function(t,n){return t+n}))/4};"mouse"===s?(document.addEventListener("mousemove",a),document.addEventListener("mouseup",u,{once:!0})):(document.addEventListener("touchmove",a),document.addEventListener("touchend",u,{once:!0})),document.removeEventListener("mousemove",t)}};document.addEventListener("mousemove",t),document.addEventListener("mousedown",o),document.addEventListener("touchstart",o),new ResizeObserver((function(){var t;!function(t,n,e){void 0===t&&(t=m.canvasPre),void 0===n&&(n=50),void 0===e&&(e=300);for(var o=t.getContext("2d"),r=Math.sqrt(2*Math.pow(Math.max(t.width,t.height)/2,2)),i=r/150,c=r/i,s=i/5,a=t.width/2,u=t.height/2,l=0;l<c;l++)for(var f=l*i,p=2*Math.PI*f,h=Math.round(p/(4*s)),d=0;d<h;d++){var y=d*(I/h),v=y/I+Math.random()/2,w=B(a+f,u,a,u,y),g=w.x,b=w.y;o.fillStyle="hsl("+S(n,e,v%1)+", 50%, 50%)",o.beginPath(),o.arc(g,b,s,0,I),o.fill()}}(),(t=w.post.createRadialGradient(Xt.nx(0),Xt.ny(0),Xt.width(.225),Xt.nx(0),Xt.ny(0),Xt.width(.45))).addColorStop(0,j),t.addColorStop(.25,j),t.addColorStop(1,A),P(m.canvasPost),w.post.lineWidth=Xt.width(.006),w.post.strokeStyle=T,w.post.fillStyle=t,w.post.beginPath(),w.post.arc(Xt.nx(0),Xt.ny(0),Xt.width(.45),0,I),w.post.fill(),w.post.stroke(),Y.forEach((function(t){t.offscreen.needsUpdate=!0})),Yt.move(0,0)})).observe(m.canvasTiles)}(),(d=Lt(Lt([],Tt),st)).forEach((function(t,n){var e=t.id,o=t.name,r=document.createElement("button"),i=document.createElement("canvas");r.append(i),r.disabled=!0,r.id=e;var c=t.id.substr(0,2);m[c].append(r),Object.assign(r.style,{width:"7.5vh",height:"7.5vh",background:A}),r.onclick=function(t){t.stopPropagation(),kt(),function(t,n){t.position.set(tt.mapX,tt.mapY),Yt.previewEntity=t;var e=function(){var n=Math.round(tt.mapX),e=Math.round(tt.mapY);t.position.set(n,e),t.disabled=!t.fitsInMap()},o=function(){if(t.disabled)document.addEventListener("click",o,{once:!0});else{var r=t.position,i=r.x,c=r.y;n({x:i,y:c}),Yt.previewEntity=null,document.removeEventListener("mousemove",e)}};document.addEventListener("mousemove",e),document.addEventListener("click",o,{once:!0})}(d[n],"instrument"===o?ct[e]:jt[e])},new ResizeObserver((function(){P(i),function(t,n){P(t);var e=t.getContext("2d"),o=n.id.substr(0,2);if("oscillator"===n.name&&(n.renderBaseShape(t.width/2,t.height/1.75,e,t.width*("co"===o?.15:.3),t.width/15),e.stroke()),"instrument"===n.name){t.width=m.canvasInstruments.width,t.height=m.canvasInstruments.height;var r=nt.x,i=nt.y;e.save(),e.setTransform(5.5,0,0,5.5*i/r,-4.5*t.width/2,-(5.5*i/r-1)*t.height/2),n.render(e),e.restore(),e.scale(1,i/r)}e.font=t.width/5+'px "Verdana", sans-serif',e.fillStyle=T,e.textAlign="center";var c=function(t){var n=t/1e6;if(n>1)return n+"M";var e=t/1e3;return e>1?e+"K":t+""}(n.cost),s=e.measureText(c);e.fillText(c,t.width/2,1.75*s.actualBoundingBoxAscent)}(i,t)})).observe(r)})),Object.entries(m).forEach((function(t){var n=t[0],e=t[1];Object.assign(e.style,It[n])})),document.body.style.background="black",new V({x:1,y:0}),new $({x:0,y:0});var Dt=new Ut;Dt.showPanel(0),document.body.appendChild(Dt.dom),Dt.dom.style.width="unset",Dt.dom.style.height="unset";var Ft=R.notes,Ht=0,zt=function(t){var n=(t-Ht)/1e3;Ht=t,Dt.begin(),Yt.velocity.sum()&&Yt.move(Yt.velocity.x,Yt.velocity.y,n),Yt.render(),Ct&&R.notes!==Ft&&(console.log("update"),qt()),Ft=R.notes,Dt.end(),window.requestAnimationFrame(zt)};Yt.move(0,0),window.requestAnimationFrame(zt)})()})();